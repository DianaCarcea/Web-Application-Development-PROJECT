PREFIX wd: <http://www.wikidata.org/entity/>
PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX p: <http://www.wikidata.org/prop/>
PREFIX ps: <http://www.wikidata.org/prop/statement/>
PREFIX psv: <http://www.wikidata.org/prop/statement/value/>
PREFIX wikibase: <http://wikiba.se/ontology#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX schema: <http://schema.org/>

SELECT ?artwork
       (SAMPLE(?title_) AS ?title)
       (SAMPLE(?image_) AS ?image)
       (SAMPLE(?inception_) AS ?inception)
       (SAMPLE(?startTime_) AS ?startTime)
       (SAMPLE(?pointInTime_) AS ?pointInTime)
       (SAMPLE(?publicationDate_) AS ?publicationDate)
       (SAMPLE(?description_) AS ?description)

       # Agregare cu separator pentru liste
       # Aici nu aveam conflict (artistName vs artistNames), dar e bine sa fim consistenti
       (GROUP_CONCAT(DISTINCT ?artistName; separator="|") AS ?artistNames)
       (GROUP_CONCAT(DISTINCT ?locationName; separator="|") AS ?locationNames)

       # Dimensiuni - redenumim variabilele interne cu sufixul _
       (SAMPLE(?heightValue_) AS ?heightValue)
       (SAMPLE(?heightUnitLabel_) AS ?heightUnitLabel)
       (SAMPLE(?widthValue_) AS ?widthValue)
       (SAMPLE(?widthUnitLabel_) AS ?widthUnitLabel)
       (SAMPLE(?conditionLabel_) AS ?conditionLabel)

       # Liste
       (GROUP_CONCAT(DISTINCT ?instanceLabel; separator="|") AS ?instanceLabels)
       (GROUP_CONCAT(DISTINCT ?subclassLabel; separator="|") AS ?subclassLabels)
       (GROUP_CONCAT(DISTINCT ?artFormLabel; separator="|") AS ?artFormLabels)
       (GROUP_CONCAT(DISTINCT ?genreLabel; separator="|") AS ?genreLabels)
       (GROUP_CONCAT(DISTINCT ?materialLabel; separator="|") AS ?materialLabels)
       (GROUP_CONCAT(DISTINCT ?inventoryNumber; separator=", ") AS ?inventoryNumbers)

WHERE {
  VALUES ?artwork {
    {{ARTWORK_IDS}}
  }

  # Am adaugat _ la variabilele interne pentru a evita conflictul de scope
  OPTIONAL { ?artwork rdfs:label ?title_ FILTER(LANG(?title_)="en") }
  OPTIONAL { ?artwork wdt:P18 ?image_ }
  OPTIONAL { ?artwork wdt:P571 ?inception_ }
  OPTIONAL { ?artwork wdt:P580 ?startTime_ }
  OPTIONAL { ?artwork wdt:P585 ?pointInTime_ }
  OPTIONAL { ?artwork wdt:P577 ?publicationDate_ }
  OPTIONAL { ?artwork schema:description ?description_ FILTER(LANG(?description_)="en") }

  # Dimensiuni (Înălțime)
  OPTIONAL {
      ?artwork p:P2048 ?heightStmt .
      ?heightStmt ps:P2048 ?heightValue_ .
      ?heightStmt psv:P2048 ?heightValueNode .
      ?heightValueNode wikibase:quantityUnit ?heightUnit .
      ?heightUnit rdfs:label ?heightUnitLabel_ FILTER(LANG(?heightUnitLabel_)="en")
  }

  # Dimensiuni (Lățime)
  OPTIONAL {
      ?artwork p:P2049 ?widthStmt .
      ?widthStmt ps:P2049 ?widthValue_ .
      ?widthStmt psv:P2049 ?widthValueNode .
      ?widthValueNode wikibase:quantityUnit ?widthUnit .
      ?widthUnit rdfs:label ?widthUnitLabel_ FILTER(LANG(?widthUnitLabel_)="en")
  }

  OPTIONAL {
      ?artwork wdt:P5816 ?condition .
      ?condition rdfs:label ?conditionLabel_ FILTER(LANG(?conditionLabel_)="en")
  }

  # Instanță și Subclasă
  OPTIONAL {
      ?artwork wdt:P31 ?instance .
      ?instance rdfs:label ?instanceLabel FILTER(LANG(?instanceLabel)="en") .
      OPTIONAL {
          ?instance wdt:P279 ?subclass .
          ?subclass rdfs:label ?subclassLabel FILTER(LANG(?subclassLabel)="en")
      }
  }

  OPTIONAL {
      ?artwork wdt:P2596 ?artForm .
      ?artForm rdfs:label ?artFormLabel FILTER(LANG(?artFormLabel)="en")
  }

  OPTIONAL {
      ?artwork wdt:P136 ?genre .
      ?genre rdfs:label ?genreLabel FILTER(LANG(?genreLabel)="en")
  }

  OPTIONAL {
      ?artwork wdt:P186 ?material .
      ?material rdfs:label ?materialLabel FILTER(LANG(?materialLabel)="en")
  }

  OPTIONAL {
      ?artwork p:P217 ?inventoryStmt .
      ?inventoryStmt ps:P217 ?inventoryNumber .
  }

  # Locație
  OPTIONAL {
      ?artwork wdt:P276 ?location .
      ?location rdfs:label ?locationName FILTER(LANG(?locationName)="en")
  }

  # Artist
  OPTIONAL {
      ?artwork wdt:P170 ?artist .
      ?artist rdfs:label ?artistName FILTER(LANG(?artistName)="en")
  }
}
GROUP BY ?artwork